---
title: "Wednesday Night Basketball Stats"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(DT)
library(dplyr)
library(tidyr)
# devtools::install_github("haozhu233/kableExtra")
library(kableExtra)
```

```{r data, include=FALSE, echo=FALSE}
df <- read.csv("data/individual_scores.csv", stringsAsFactors = FALSE)

games_w_pts <- df %>%
  select(Game, Player, Team) %>%
  distinct() %>%
  group_by(Player, Team) %>%
  summarize(`Games W/ Pts` = length(Game))

get_points <- function(df){
  tmp <- df %>%
    group_by(Player) %>%
    summarize(`Points (2s)` = sum(Score[Score == 2]),
              `Points (3s)` = sum(Score[Score == 3]),
              `Total Points` = sum(Score)) %>%
    t() %>%
    as.data.frame(stringsAsFactors = FALSE)
  names(tmp) <- tmp[1,]
  tmp <- tmp[-1,]
  tmp$Value <- rownames(tmp)
  return(tmp)
}

get_buckets <- function(df){
  tmp <- df %>%
    group_by(Player) %>%
    summarize(`Buckets (2s)` = length(Score[Score == 2]),
              `Buckets (3s)` = length(Score[Score == 3]),
              `Total Buckets` = length(Score)) %>%
    t() %>%
    as.data.frame(stringsAsFactors = FALSE)
  names(tmp) <- tmp[1,]
  tmp <- tmp[-1,]
  tmp$Value <- rownames(tmp)
  return(tmp)
}

get_pts_df <- function(df, team_num){
  tm_pts <- df %>%  
    filter(Team == team_num) %>%
    group_by(Game) %>%
    group_map(~ get_points(.x)) 
  names(tm_pts) <- unique(df$Game)
  date_col <- unlist(lapply(tm_pts, nrow))
  date_col <- rep(names(date_col), as.numeric(date_col))
  
  tm_pts <- do.call(bind_rows, tm_pts)
  tm_pts$Date <- date_col
  tm_pts <- tm_pts %>% 
    select(Date, Value, everything()) %>%
    replace(is.na(.), 0)
  # Overall rows...
  tm_pts <- rbind(tm_pts,
                   c("Total", "Games W/ Pts",
                     games_w_pts$`Games W/ Pts`[
                       match(names(tm_pts)[3:ncol(tm_pts)], games_w_pts$Player)]),
                   stringsAsFactors = FALSE)
  
  tm_ov_tot <- tm_pts %>%
    filter(Value == "Total Points") %>%
    select(-Date, -Value) %>%
    mutate_if(is.character, as.numeric)
  
  tm_pts <- rbind(tm_pts,
                   c("Total", "Total Pts", apply(tm_ov_tot, 2, sum)),
                   stringsAsFactors = FALSE)
  
  tm_pts <- rbind(tm_pts,
                   c("Total", "Avg Pts",
                     round(as.numeric(tm_pts[nrow(tm_pts), (3:ncol(tm_pts))]) / 
                             as.numeric(tm_pts[(nrow(tm_pts) - 1), (3:ncol(tm_pts))]), 1)),
                   stringsAsFactors = FALSE)
  return(tm_pts)
}

get_bkts_df <- function(df, team_num){
  tm_bkts <- df %>%  
    filter(Team == team_num) %>%
    group_by(Game) %>%
    group_map(~ get_buckets(.x)) 
  names(tm_bkts) <- unique(df$Game)
  date_col <- unlist(lapply(tm_bkts, nrow))
  date_col <- rep(names(date_col), as.numeric(date_col))
  
  tm_bkts <- do.call(bind_rows, tm_bkts)
  tm_bkts$Date <- date_col
  tm_bkts <- tm_bkts %>% 
    select(Date, Value, everything()) %>%
    replace(is.na(.), 0)
  # Overall rows...
  tm_bkts <- rbind(tm_bkts,
                    c("Total", "Games W/ Pts",
                      games_w_pts$`Games W/ Pts`[match(names(tm_bkts)[3:ncol(tm_bkts)],                           games_w_pts$Player)]),
                    stringsAsFactors = FALSE)
  
  tm_ov_tot <- tm_bkts %>%
    filter(Value == "Total Buckets") %>%
    select(-Date, -Value) %>%
    mutate_if(is.character, as.numeric)
  
  tm_ov_2 <- tm_bkts %>%
    filter(Value == "Buckets (2s)") %>%
    select(-Date, -Value) %>%
    mutate_if(is.character, as.numeric)
  
  tm_ov_3 <- tm_bkts %>%
    filter(Value == "Buckets (3s)") %>%
    select(-Date, -Value) %>%
    mutate_if(is.character, as.numeric)
  
  tm_bkts <- rbind(tm_bkts,
                    c("Total", "Total Bkts", apply(tm_ov_tot, 2, sum)),
                    stringsAsFactors = FALSE)
  
  tm_bkts <- rbind(tm_bkts,
                    c("Total", "Total 2s", apply(tm_ov_2, 2, sum)),
                    stringsAsFactors = FALSE)
  
  tm_bkts <- rbind(tm_bkts,
                    c("Total", "Total 3s", apply(tm_ov_3, 2, sum)),
                    stringsAsFactors = FALSE)
  
  tm_bkts <- rbind(tm_bkts,
                    c("Total", "Avg 2s",
                      round(as.numeric(tm_bkts[(nrow(tm_bkts) - 1), (3:ncol(tm_bkts))]) /
                              as.numeric(tm_bkts[(nrow(tm_bkts) - 3), (3:ncol(tm_bkts))]), 1)),
                    stringsAsFactors = FALSE)
  
  tm_bkts <- rbind(tm_bkts,
                    c("Total", "Avg 3s",
                      round(as.numeric(tm_bkts[(nrow(tm_bkts) - 1), (3:ncol(tm_bkts))]) /
                              as.numeric(tm_bkts[(nrow(tm_bkts) - 4), (3:ncol(tm_bkts))]), 1)),
                    stringsAsFactors = FALSE)
  return(tm_bkts)
  
}
```
Updated on `r Sys.time()`  

## Teams {.tabset .tabset-fade}

Team 1 | Team 2 | Team 3 | Team 4
------------- | ------------- | ------------- | -------------
Mike B. | Tim K. | Mike W. | Mike S.
Pat B. | Rubin J. | Frankie C. | Mike P.
Ryan B. | Jon T. | Andy W. | Erik V.
Jason W. | Steve F. | Adam B. | Brian F.
Lance J. | Chris T. | Danny S. | Matt S.
Howie M. | Brian H. | Joel E. | Jon D.
Steve G. | Jay L. | Cory N. | Ryan C.
Scott S. | Pat C. | Mike S. | Aaron M.

### Team 1 
#### Points
```{r team1_pts, echo=FALSE}
tm1_pts <- get_pts_df(df, 1)
kable(tm1_pts, linesep = "") %>%
  kable_styling(full_width = TRUE) %>%
  row_spec(as.numeric(row.names(tm1_pts[tm1_pts$Date %in%
                                unique(tm1_pts$Date)[c(TRUE, FALSE)],])),
           background = "#f8f8f8")
```
#### Buckets
```{r team1_bkts, echo=FALSE}
tm1_bkts <- get_bkts_df(df, 1)
kable(tm1_bkts, linesep = "") %>%
  kable_styling(full_width = TRUE) %>%
  row_spec(as.numeric(row.names(tm1_bkts[tm1_bkts$Date %in%
                                unique(tm1_bkts$Date)[c(TRUE, FALSE)],])),
           background = "#f8f8f8")
```
### Team 2 
#### Points
```{r team2_pts, echo=FALSE}
tm2_pts <- get_pts_df(df, 2)
kable(tm2_pts, linesep = "") %>%
  kable_styling(full_width = TRUE) %>%
  row_spec(as.numeric(row.names(tm2_pts[tm2_pts$Date %in%
                                unique(tm2_pts$Date)[c(TRUE, FALSE)],])),
           background = "#f8f8f8")
```
#### Buckets
```{r team2_bkts, echo=FALSE}
tm2_bkts <- get_bkts_df(df, 2)
kable(tm2_bkts, linesep = "") %>%
  kable_styling(full_width = TRUE) %>%
  row_spec(as.numeric(row.names(tm2_bkts[tm2_bkts$Date %in%
                                unique(tm2_bkts$Date)[c(TRUE, FALSE)],])),
           background = "#f8f8f8")
```
### Team 3 
#### Points
```{r team3_pts, echo=FALSE}
tm3_pts <- get_pts_df(df, 3)
kable(tm3_pts, linesep = "") %>%
  kable_styling(full_width = TRUE) %>%
  row_spec(as.numeric(row.names(tm3_pts[tm3_pts$Date %in%
                                unique(tm3_pts$Date)[c(TRUE, FALSE)],])),
           background = "#f8f8f8")
```
#### Buckets
```{r team3_bkts, echo=FALSE}
tm3_bkts <- get_bkts_df(df, 3)
kable(tm3_bkts, linesep = "") %>%
  kable_styling(full_width = TRUE) %>%
  row_spec(as.numeric(row.names(tm3_bkts[tm3_bkts$Date %in%
                                unique(tm3_bkts$Date)[c(TRUE, FALSE)],])),
           background = "#f8f8f8")
```
### Team 4 
#### Points
```{r team4_pts, echo=FALSE}
tm4_pts <- get_pts_df(df, 4)
kable(tm4_pts, linesep = "") %>%
  kable_styling(full_width = TRUE) %>%
  row_spec(as.numeric(row.names(tm4_pts[tm4_pts$Date %in%
                                unique(tm4_pts$Date)[c(TRUE, FALSE)],])),
           background = "#f8f8f8")
```
#### Buckets
```{r team4_bkts, echo=FALSE}
tm4_bkts <- get_bkts_df(df, 4)
kable(tm4_bkts, linesep = "") %>%
  kable_styling(full_width = TRUE) %>%
  row_spec(as.numeric(row.names(tm4_bkts[tm4_bkts$Date %in%
                                unique(tm4_bkts$Date)[c(TRUE, FALSE)],])),
           background = "#f8f8f8")
```




 



